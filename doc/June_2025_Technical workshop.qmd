---
# title: "CCSBT Technical Workshop Summary"
# subtitle: "June 24–28, 2025 · Seattle, WA"
# author: "Workshop Participants"
# date: 2025-06-29
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    theme: cosmo
    # title-block-banner: true
    # title-block-logo: images/ccsbt_logo.png
    embed-resources: true
bibliography: references.bib
---

<!-- Manually define your own title block -->
<div style="display: flex; align-items: center; gap: 1em; margin-bottom: 1.5em;">
  <img src="images/ccsbt_logo.png" width="100" alt="CCSBT logo" style="flex-shrink: 0;">
  <div style="font-size: 2em; font-weight: bold;">
    CCSBT Technical Workshop Summary
  </div>
</div>

<div style="font-size: 1.2em; text-align: center; margin-bottom: 0.5em;">
  June 24–28, 2025 · Seattle, WA
</div>

---

# Overview/summary

In June 2025, a small technical working group was convened at the behest of the 
CCSBT to address the ongoing development of the assessment and operating model 
upgrades using RTMB (R-Template Model Builder). This workshop was held at the
at the University of Washington and met from 0900-1700 each day. 
Major efforts focused on porting legacy ADMB/TMB code to RTMB, refining MCMC and 
selectivity functionality. The group also enhanced model diagnostics and usability.
We note that the evolution of the model had an important development to change from 
using "pure" TMB (basically a C++ library with quite strict coding practices, @Kristensen2016) to a
version that can use code and all variable definitions (for data and parameters; @RTMB) 
completely within the R programming environment [@R-base].
The next section summarizes a rough outline of tasks addressed during the workshop. 

# Agenda Topics and Task Summary

## Convert ADMB/TMB to RTMB

- **Dynamics**: Successfully translated state dynamics to RTMB for all the relavent population
processes.
- **Likelihoods**: Continued work integrated more components including robust likelihoods and tag-based data.
This was completed in two steps, first including the original ADMB-compatible likelihood components and 
then updating with the refined and improved version (equivalent to the "v4" TMB model from 2023. 

## MCMC and Profiling

- **MCMC runs on V1 RTMB code**: Initial runs completed; diagnostics indicate divergence in some configurations.
- **Likelihood profiling tailored to `sbt_model`**: Work initiated and completed.

## Fleet and Selectivity Adjustments

- **LL3 and LL4 as direct removals**: LL4 implemented; LL3 flagged due to high early 
catches—requires careful MCMC evaluation. This was retained as an option but issues identified
earlier on appear to be resolved.
- **Japanese LL size composition**: Set up switches to toggle between LL1 and CPUE-based length frequencies.

## MSY and Projections

The following features were identified to enhance the model's MSY estimation and projections:

- **MSY estimation**: Framework coded with conditioning on selectivity, size, and catch allocations.
- **Projection code**: Implemented time-invariant weights and ALKs.
- **ARIMA for Rdev and q projections**: Catchability now includes autocorrelation and effort creep.
- **Multivariate ARIMA for selectivity**: Design requires full simulation of datasets.
- **Projection specifications**: Drafted options (AR1 vs. multivariate ARIMA) for Darcy to implement.

## Model Features and Testing

- **OSA residuals**: Preliminary tests were made but further development required (this is an alternative
model diagnostic).
- **2D AR1 selectivity**: Behavior verified when defined and successfully implemented(e.g., LL4)—issues 
identified in previous years appear to be completely resolved(!).

## Utilities and Communications

- **Example scripts**: Prepared scripts for running models, generating likelihood profiles, and basic diagnostics.
- **Issue on multinomial density**: Submitted to TMB / RTMB developer.
- **Divergent transitions plot**: Developed a plot to visualize divergent transitions in 
MCMC runs, aiding in diagnostics. This enhances the R package ADNUTS


---

# Participants

1. Ana Parma
2. D'arcy Webber
3. Richard Hillary
4. Paige Eveson
5. James Ianelli  


![Group photo from the OMMP workshop](images/Workshop_photo.png)

/Users/jim/Downloads/Report June_2025_Technical workshop.qmd